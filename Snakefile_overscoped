SAMPLES = ["A", "B"]
MARKERS = ["a", "b", "c"]

rule all:
    input:
        #["trees/consensus/{sample}/consensus.tree".format(sample=sample) for sample in SAMPLES]
        "distance.matrix"

rule kraken_report:
    input:
        "data/sample.fastq",
        "data/{sample}.fastq"
    output:
        temp("kraken/{sample}.kraken.report")
    shell:
        "bwa mem {input} | samtools view -Sb - > {output}"


rule get_NCBI_genome:
    input:
        "kraken/{sample}.kraken.report"
    output:
        temp("ncbi/{sample}")
    shell:
        "samtools sort -T sorted_reads/{wildcards.sample} "
        "-O bam {input} > {output}"


rule build_tree:
    input:
        genome = "ncbi/{sample}",
        report = "kraken/{sample}.kraken.report",
        marker = expand("data/{marker}.marker", marker=MARKERS)
    output:
        "trees/{sample}/{marker}"
    shell:
        "samtools index {input}"

rule build_consensus_tree:
    input:
        expand("trees/{{sample}}/{marker}", marker=MARKERS)
    output:
        temp("trees/consensus/{sample}/consensus.tree")
    shell:
        "shell script"

rule calc_distance:
    input:
        expand("trees/consensus/{sample}/consensus.tree", sample=SAMPLES)
    output:
        "distance.matrix"
    script:
        "scripts/plot-quals.py"

